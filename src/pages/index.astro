---
import Layout from '../layouts/Layout.astro';
import { getCollection } from 'astro:content';

const posts = await getCollection('blog', ({ data }) => {
  return !data.draft;
});

// Sort posts by date (newest first)
posts.sort((a, b) => {
  const dateA = a.data?.data?.pubDate || a.data?.pubDate ? new Date(a.data?.data?.pubDate || a.data?.pubDate) : new Date(0);
  const dateB = b.data?.data?.pubDate || b.data?.pubDate ? new Date(b.data?.data?.pubDate || b.data?.pubDate) : new Date(0);
  return dateB.getTime() - dateA.getTime();
});

// Show all posts
const recentPosts = posts;

function formatDate(date: Date | string | undefined) {
  if (!date) return 'Unknown date';
  const dateObj = date instanceof Date ? date : new Date(date);
  if (isNaN(dateObj.getTime())) return 'Unknown date';
  return dateObj.toLocaleDateString('en-US', {
    year: 'numeric',
    month: 'short',
    day: 'numeric'
  });
}
---

<Layout title="RANDOBLOG - Random Thoughts & Projects of a Wannabe Scientist" description="A blog containing random thoughts and projects of a wannabe scientist">

  <!-- Recent Posts Section -->
  <section class="px-6 pt-12 pb-16">
    <div class="max-w-4xl mx-auto">

      {recentPosts.length === 0 ? (
        <div class="text-center py-24">
          <div class="card max-w-md mx-auto">
            <div class="text-text-muted mb-4">
              No posts yet
            </div>
            <div class="text-text-muted text-sm">
              Check back soon for new content!
            </div>
          </div>
        </div>
      ) : (
              <!-- Posts Container -->
        <div id="posts-container" class="space-y-8">
          {recentPosts.map((post) => (
            <article class="card hover:border-accent-primary/30 transition-all duration-300 group">
              <div class="flex flex-col lg:flex-row lg:items-start lg:justify-between mb-4 gap-2">
                <h3 class="text-xl font-semibold text-text-primary group-hover:text-accent-primary transition-colors duration-300 lg:flex-1 lg:pr-4">
                  <a href={`/blog/${post.id}`}>
                    {post.data?.data?.title || post.data?.title || post.id}
                  </a>
                </h3>
                <div class="text-text-muted text-sm lg:flex-shrink-0 lg:text-right lg:min-w-[100px]">
                  {formatDate(post.data?.data?.pubDate || post.data?.pubDate)}
                </div>
              </div>

              <p class="text-text-secondary mb-4 leading-relaxed">
                {post.data?.data?.description || post.data?.description || 'No description available'}
              </p>

              <div class="flex flex-wrap gap-2 mb-4">
                {(post.data?.data?.tags || post.data?.tags) && (post.data?.data?.tags || post.data?.tags).length > 0 && (post.data?.data?.tags || post.data?.tags).map((tag) => (
                  <span class="tag-secondary">
                    {tag}
                  </span>
                ))}
                {(post.data?.data?.repository || post.data?.repository) && (
                  <span class="tag-primary">
                    üìÅ {post.data?.data?.repository || post.data?.repository}
                  </span>
                )}
              </div>

              <div class="flex items-center justify-between">
                <a href={`/blog/${post.id}`} class="text-accent-primary hover:text-accent-secondary transition-colors duration-200 font-medium">
                  Read more ‚Üí
                </a>
                {(post.data?.data?.repositoryUrl || post.data?.repositoryUrl) && (
                  <a href={post.data?.data?.repositoryUrl || post.data?.repositoryUrl} target="_blank" rel="noopener noreferrer" class="text-text-muted hover:text-accent-secondary transition-colors duration-200 text-sm">
                    View on GitHub ‚Üó
                  </a>
                )}
              </div>
            </article>
          ))}
        </div>
      )}


    </div>
  </section>





</Layout>
